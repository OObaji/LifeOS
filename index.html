<!DOCTYPE html>
<html lang="en" class="overflow-x-hidden">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LifeOS - Second Brain</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        zinc: {
                            850: '#1f1f22',
                            950: '#09090b',
                        }
                    }
                }
            }
        }
    </script>
    
    <style>
        body { 
            -webkit-font-smoothing: antialiased; 
            touch-action: manipulation;
        }
        /* Scrollbar styling */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #52525b; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #71717a; }
        
        /* Hide scrollbar for Chrome, Safari and Opera */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        /* Hide scrollbar for IE, Edge and Firefox */
        .no-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .animate-shake {
            animation: shake 0.2s ease-in-out 2;
        }
        .landing-gradient {
            background: linear-gradient(135deg, #09090b 0%, #18181b 100%);
        }
        .timer-progress {
            transition: stroke-dashoffset 1s linear;
        }
    </style>
</head>
<body class="bg-zinc-950 text-zinc-100 min-h-screen overflow-y-auto">
    <div id="root"></div>

    <!-- Application Logic -->
    <script type="module">
        import React, { useState, useEffect, useRef } from "https://esm.sh/react@18.2.0";
        import { createRoot } from "https://esm.sh/react-dom@18.2.0/client";
        import { 
            Layout, Home, BookOpen, Target, PenTool, Settings, Search, Bell, Plus, 
            MoreHorizontal, CheckCircle2, Clock, ArrowRight, Brain, Layers, 
            Calendar as CalendarIcon, ChevronRight, Sun, Moon, Filter, Zap, Coffee, 
            Video, MapPin, RefreshCw, MoreVertical, Lightbulb, Sparkles, Trash2, 
            Sprout, Briefcase, DollarSign, Move, Eraser, Palette, MousePointer2, 
            Trophy, Flag, TrendingUp, Award, Crosshair, Star, Bookmark, Book, 
            GraduationCap, Wallet, Building, Users, ExternalLink, Link as LinkIcon, 
            PlayCircle, Film, Music, Gamepad2, MonitorPlay, Headphones, Tv, 
            MessageSquare, AlertCircle, Folder, Minus, CalendarDays, LogOut, Lock, 
            Fingerprint, Delete, KeyRound, ShieldQuestion, RotateCcw, Menu, X, Save, Edit3, Wifi, WifiOff, Database,
            Timer, Play, Pause, Wrench, File, CreditCard, Coins, Heart, Activity, Scissors, Share2, Mail, Archive, Image,
            Cloud, CloudRain, CloudSun, CloudSnow, CloudLightning, Thermometer,
            List, Grid, Columns, Utensils, FileText, Trash, ShieldAlert, Flame, Volume2, ChevronLeft,
            ListTodo, ArrowUpRight, CheckSquare, Flower2, Dumbbell, Github, Bot, Newspaper, QrCode,
            Waves, Wind, Mountain, Footprints, Ban, ShieldCheck, Milestone, User, LogIn, ArrowLeft, Info,
            Eye, EyeOff
        } from "https://esm.sh/lucide-react@0.344.0?deps=react@18.2.0";

        // --- FIREBASE IMPORTS ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { 
            getAuth, 
            signInWithCustomToken, 
            signInAnonymously, 
            onAuthStateChanged, 
            signOut,
            signInWithEmailAndPassword,
            createUserWithEmailAndPassword,
            GoogleAuthProvider,
            signInWithPopup
        } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, doc, onSnapshot, addDoc, updateDoc, deleteDoc, query, orderBy, serverTimestamp, setDoc, getDoc, writeBatch } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // --- CONFIGURATION ---
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
            apiKey: "", 
            authDomain: "secondbrain-8d8cd.firebaseapp.com",
            projectId: "secondbrain-8d8cd",
            storageBucket: "secondbrain-8d8cd.firebasestorage.app",
            messagingSenderId: "1913632272",
            appId: "1:1913632272:web:324f366a35e6dd07cffc95"
        };
        
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'kaizen-os-prod';
        
        // Initialize Firebase
        let app, auth, db;
        let isFirebaseConfigured = false;
        
        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
            isFirebaseConfigured = true;
        } catch (e) {
            console.warn("Firebase Init Error:", e);
        }

        // --- LOCAL AUTH SIMULATION ---
        const LocalAuth = {
            login: (email, password) => {
                const users = JSON.parse(localStorage.getItem('lifeos_local_db_users') || '{}');
                const user = users[email.toLowerCase()];
                if (!user) throw new Error("User not found locally. Please create an account.");
                if (user.password !== password) throw new Error("Incorrect password.");
                return { email: user.email, uid: user.uid, isLocal: true, displayName: user.displayName || user.email.split('@')[0] };
            },
            signup: (email, password) => {
                const users = JSON.parse(localStorage.getItem('lifeos_local_db_users') || '{}');
                if (users[email.toLowerCase()]) throw new Error("Account already exists. Please sign in.");
                
                const uid = 'local_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                const displayName = email.split('@')[0];
                users[email.toLowerCase()] = { email, password, uid, displayName };
                localStorage.setItem('lifeos_local_db_users', JSON.stringify(users));
                
                return { email, uid, isLocal: true, displayName };
            }
        };

        // --- DEFAULT TOOLS DATA ---
        const DEFAULT_TOOLS = [
            { id: 't1', category: 'Productivity HQ', name: 'ChatGPT', url: 'https://chat.openai.com/', icon: 'Bot' },
            { id: 't2', category: 'Productivity HQ', name: 'Notion', url: 'https://www.notion.so/', icon: 'Layers' },
            { id: 't3', category: 'Productivity HQ', name: 'G-Cal', url: 'https://calendar.google.com/', icon: 'CalendarIcon' },
            { id: 't4', category: 'Dev & Career', name: 'GitHub', url: 'https://github.com/', icon: 'Github' },
            { id: 't5', category: 'Dev & Career', name: 'LinkedIn', url: 'https://www.linkedin.com/', icon: 'Users' },
            { id: 't6', category: 'Finance', name: 'TradingView', url: 'https://www.tradingview.com/', icon: 'TrendingUp' },
            { id: 't7', category: 'Finance', name: 'Wise', url: 'https://wise.com/', icon: 'RefreshCw' },
            { id: 't8', category: 'Utilities', name: 'Speedtest', url: 'https://www.speedtest.net/', icon: 'Wifi' },
            { id: 't9', category: 'Utilities', name: 'WeTransfer', url: 'https://wetransfer.com/', icon: 'Share2' }
        ];

        // --- DATA CONSTANTS ---
        const DEFAULT_GOALS_DATA = {
            mission: "Reshape my life by achieving financial stability, building iron discipline, and gaining clear direction for my future.",
            phases: {
                phase1: [
                    { id: 'p1_1', text: "Clear unsecured debt (£0)", completed: false },
                    { id: 'p1_2', text: "School fees paid in full", completed: false },
                    { id: 'p1_3', text: "Expenses minimized (Survival mode)", completed: false }
                ],
                phase2: [
                    { id: 'p2_1', text: "Consistent Wake/Sleep (21 days)", completed: false },
                    { id: 'p2_2', text: "Established Prayer & Word Routine", completed: false },
                    { id: 'p2_3', text: "Deep Work System Installed", completed: false }
                ],
                phase3: [
                    { id: 'p3_1', text: "High-Income Skill Mastered", completed: false },
                    { id: 'p3_2', text: "3+ Portfolio Projects Built", completed: false },
                    { id: 'p3_3', text: "Secure Grad Role/Business", completed: false }
                ]
            },
            quarters: {
                q1: [
                    { id: 'q1_1', text: "Establish strict yearly budget (Separate from debt)", completed: false },
                    { id: 'q1_2', text: "Keep sleep schedule consistent", completed: false },
                    { id: 'q1_3', text: "Complete Web Innovation Project", completed: false },
                    { id: 'q1_4', text: "Complete Dissertation Log 2 & 3", completed: false },
                    { id: 'q1_5', text: "Complete Machine Learning Project", completed: false },
                    { id: 'q1_6', text: "Study & Sit for Cyber Security Exam", completed: false },
                    { id: 'q1_7', text: "Start & Lock-in Dissertation", completed: false },
                    { id: 'q1_8', text: "Pay towards Tuition Fees", completed: false },
                    { id: 'q1_9', text: "Get someone to take over tenancy for Liverpool apartment", completed: false },
                    { id: 'q1_10', text: "Never miss a workout session (4 days weekly)", completed: false },
                    { id: 'q1_11', text: "Never miss morning run", completed: false },
                    { id: 'q1_12', text: "Add a database to LifeOS app", completed: false },
                    { id: 'q1_13', text: "Master systems (Journal, LifeOS, Calendar, Fitness)", completed: false },
                    { id: 'q1_14', text: "Daily Bible & Prayer (Even 1 verse counts)", completed: false }
                ],
                q2: [],
                q3: [],
                q4: []
            },
            execution: {
                weekly: [
                    { id: 'w1', text: "Income Action (Extra Shift/Task)", completed: false },
                    { id: 'w2', text: "5-10 Hours Skill Acquisition", completed: false },
                    { id: 'w3', text: "Sunday Sermon & Study", completed: false },
                    { id: 'w4', text: "4-6 Workouts (Hypertrophy)", completed: false },
                    { id: 'w5', text: "Sunday Review (15 Mins)", completed: false }
                ],
                daily: [
                    { id: 'd1', text: "Wake & Sleep Consistent", completed: false },
                    { id: 'd2', text: "Pray Morning & Night (2x)", completed: false },
                    { id: 'd3', text: "Bible & Sermon (30m)", completed: false },
                    { id: 'd4', text: "Train or Move Body", completed: false },
                    { id: 'd5', text: "Night Reflection (The 'Why')", completed: false }
                ]
            }
        };

        const DEFAULT_MEALS = [
            { day: 'Monday', type: 'Breakfast', text: 'Oats + milk\n1 banana\n1 scoop protein powder' },
            { day: 'Monday', type: 'Lunch', text: 'Chicken stew\nWhite rice\n½ avocado' },
            { day: 'Monday', type: 'Snack', text: 'Greek yoghurt + apple' },
            { day: 'Monday', type: 'Dinner', text: 'Spaghetti + grilled chicken breast\n(Night: Milo + milk)' },
            { day: 'Tuesday', type: 'Breakfast', text: '3 eggs (boiled/scrambled)\nBread + peanut butter\nGrapes' },
            { day: 'Tuesday', type: 'Lunch', text: 'Jollof rice\nChicken thigh' },
            { day: 'Tuesday', type: 'Snack', text: 'Protein shake' },
            { day: 'Tuesday', type: 'Dinner', text: 'Sardines\nBoiled potatoes' },
            { day: 'Wednesday', type: 'Breakfast', text: 'Cereal + milk\nBanana' },
            { day: 'Wednesday', type: 'Lunch', text: 'Chicken breast\nRice\nAvocado' },
            { day: 'Wednesday', type: 'Snack', text: 'Greek yoghurt + grapes' },
            { day: 'Wednesday', type: 'Dinner', text: 'Spaghetti + chicken stew' },
            { day: 'Thursday', type: 'Breakfast', text: 'Oats + milk\nApple\n1 scoop protein' },
            { day: 'Thursday', type: 'Lunch', text: 'Chicken stew\nRice' },
            { day: 'Thursday', type: 'Snack', text: 'Bread + peanut butter' },
            { day: 'Thursday', type: 'Dinner', text: 'Sardines\nPotatoes' },
            { day: 'Friday', type: 'Breakfast', text: '3 eggs\nBread + jam\nBanana' },
            { day: 'Friday', type: 'Lunch', text: 'Jollof rice\nChicken breast' },
            { day: 'Friday', type: 'Snack', text: 'Greek yoghurt' },
            { day: 'Friday', type: 'Dinner', text: 'Pasta + grilled chicken thigh' },
            { day: 'Saturday', type: 'Breakfast', text: 'Cereal + milk\nGrapes' },
            { day: 'Saturday', type: 'Lunch', text: 'Chicken thigh\nRice + avocado' },
            { day: 'Saturday', type: 'Snack', text: 'Protein shake' },
            { day: 'Saturday', type: 'Dinner', text: 'Eggs (omelette)\nBread' },
            { day: 'Sunday', type: 'Breakfast', text: 'Oats + milk\nBanana' },
            { day: 'Sunday', type: 'Lunch', text: 'Rice + sardines' },
            { day: 'Sunday', type: 'Snack', text: 'Greek yoghurt + apple' },
            { day: 'Sunday', type: 'Dinner', text: 'Chicken stew\nPotatoes' }
        ];

        const WORKOUT_PLAN = [
            { id: 'day1', title: "Day 1 – Chest & Triceps", icon: Flame, color: "text-orange-500", warmup: ["Light DB presses – 15 reps", "Arm circles"], exercises: [{ name: "DB Floor Press", sets: "4", reps: "8–12" }, { name: "DB Chest Fly", sets: "3", reps: "10–15" }, { name: "Neutral-grip DB Press", sets: "3", reps: "8–12" }, { name: "Overhead DB Tri Ext", sets: "3", reps: "10–15" }], finisher: "DB Floor Press hold – 3 × 30s" },
            { id: 'day2', title: "Day 2 – Legs (DB Only)", icon: Activity, color: "text-blue-500", warmup: ["Bodyweight squats – 20", "Leg swings"], exercises: [{ name: "Goblet Squats", sets: "4", reps: "10–15" }, { name: "DB RDLs", sets: "4", reps: "8–12" }, { name: "Walking Lunges", sets: "3", reps: "10/leg" }, { name: "DB Step-Ups", sets: "3", reps: "10/leg" }], finisher: "Goblet squat hold – 2 rounds" },
            { id: 'day3', title: "Day 3 – Shoulders & Arms", icon: Dumbbell, color: "text-emerald-500", warmup: ["Light DB raises", "Arm swings"], exercises: [{ name: "Seated DB Press", sets: "4", reps: "8–12" }, { name: "DB Lateral Raises", sets: "4", reps: "12–15" }, { name: "DB Front Raises", sets: "3", reps: "12" }, { name: "Alt DB Curls", sets: "3", reps: "10–12" }], finisher: "Lateral raise partials – 2 × 30s" },
            { id: 'day4', title: "Day 4 – Arms + Chest Pump", icon: Zap, color: "text-purple-500", subtitle: "Short, intense.", warmup: [], exercises: [{ name: "DB Floor Press", sets: "4", reps: "12–15" }, { name: "Squeeze Press", sets: "3", reps: "12" }, { name: "Concentration Curls", sets: "3", reps: "10/arm" }, { name: "21s DB Curls", sets: "2", reps: "rounds" }], finisher: "Curl → press combo" }
        ];

        const GYM_WORKOUT_PLAN = [
            {
                id: 'gym1',
                title: "Day 1: Chest & Triceps",
                icon: Flame,
                color: "text-rose-500",
                warmup: ["5min Treadmill", "Arm Circles", "Pushups"],
                exercises: [
                    { name: "Barbell Bench Press", sets: "4", reps: "8-10" },
                    { name: "Incline Dumbbell Press", sets: "3", reps: "10-12" },
                    { name: "Cable Flys", sets: "3", reps: "12-15" },
                    { name: "Tricep Rope Pushdowns", sets: "4", reps: "12-15" },
                    { name: "Skullcrushers (EZ Bar)", sets: "3", reps: "10-12" }
                ],
                finisher: "Pushup burnout (2 sets to failure)"
            },
            {
                id: 'gym2',
                title: "Day 2: Back & Biceps",
                icon: Activity,
                color: "text-blue-500",
                warmup: ["5min Rower", "Band Pull-aparts"],
                exercises: [
                    { name: "Lat Pulldowns (Wide)", sets: "4", reps: "10-12" },
                    { name: "Seated Cable Row", sets: "4", reps: "10-12" },
                    { name: "Single Arm DB Row", sets: "3", reps: "10/side" },
                    { name: "Barbell Bicep Curls", sets: "3", reps: "10-12" },
                    { name: "Hammer Curls", sets: "3", reps: "12" }
                ],
                finisher: "Face Pulls 3x15"
            },
            {
                id: 'gym3',
                title: "Day 3: Legs",
                icon: Dumbbell,
                color: "text-emerald-500",
                warmup: ["Bodyweight Squats", "Leg Swings"],
                exercises: [
                    { name: "Barbell Squats", sets: "4", reps: "6-8" },
                    { name: "Leg Press", sets: "3", reps: "10-12" },
                    { name: "Romanian Deadlifts", sets: "4", reps: "10" },
                    { name: "Leg Extensions", sets: "3", reps: "15" },
                    { name: "Seated Calf Raises", sets: "4", reps: "15-20" }
                ],
                finisher: "Walking Lunges (Bodyweight)"
            },
            {
                id: 'gym4',
                title: "Day 4: Shoulders & Abs",
                icon: Zap,
                color: "text-purple-500",
                warmup: ["Shoulder dislocations (stick)", "Light DB press"],
                exercises: [
                    { name: "Overhead Barbell Press", sets: "4", reps: "8-10" },
                    { name: "DB Lateral Raises", sets: "4", reps: "12-15" },
                    { name: "Front Plate Raise", sets: "3", reps: "12" },
                    { name: "Cable Crunches", sets: "4", reps: "15" },
                    { name: "Hanging Leg Raises", sets: "3", reps: "12" }
                ],
                finisher: "Plank (3 x 1 min)"
            }
        ];

        const HOME_WORKOUT_PLAN = WORKOUT_PLAN; 

        const BIBLE_TOPICS = [
            { title: "Finance & Wealth", desc: "Stewardship & trust.", verses: ["Prov 22:7", "Matt 6:24"], chapters: ["Prov 3", "Matt 6"] },
            { title: "Overcoming Lust", desc: "Purity & self-control.", verses: ["2 Tim 2:22", "1 Cor 6:18"], chapters: ["Rom 6", "Ps 51"] },
            { title: "Power of Prayer", desc: "Communion with God.", verses: ["Phil 4:6", "1 Thess 5:17"], chapters: ["Luke 11", "Ps 145"] },
            { title: "Anxiety & Peace", desc: "Finding rest.", verses: ["1 Pet 5:7", "John 14:27"], chapters: ["Phil 4", "Ps 23"] },
            { title: "Diligence", desc: "Work unto the Lord.", verses: ["Col 3:23", "Prov 13:4"], chapters: ["Prov 6", "Eccl 3"] }
        ];

        const FOCUS_SOUNDS = [
            { id: 'rain', label: 'Rain', icon: CloudRain, url: 'https://assets.mixkit.co/active_storage/sfx/2515/2515-preview.mp3' },
            { id: 'forest', label: 'Forest', icon: CloudSun, url: 'https://assets.mixkit.co/active_storage/sfx/2511/2511-preview.mp3' },
            { id: 'fire', label: 'Fire', icon: Flame, url: 'https://assets.mixkit.co/active_storage/sfx/2513/2513-preview.mp3' },
            { id: 'cafe', label: 'Cafe', icon: Coffee, url: 'https://assets.mixkit.co/active_storage/sfx/96/96-preview.mp3' },
            { id: 'lofi', label: 'Lofi', icon: Music, url: 'https://cdn.pixabay.com/audio/2022/11/22/audio_febc508520.mp3' },
            { id: 'ocean', label: 'Ocean', icon: Waves, url: 'https://assets.mixkit.co/active_storage/sfx/1126/1126-preview.mp3' },
            { id: 'thunder', label: 'Thunder', icon: CloudLightning, url: 'https://assets.mixkit.co/active_storage/sfx/2507/2507-preview.mp3' }
        ];

        const DAILY_SPIRITUALITY = [
            { verse: "Joshua 1:9", text: "Be strong and courageous...", prayer: "Lord, grant me courage.", encouragement: "You are never alone." },
            { verse: "Jer 29:11", text: "Plans to prosper you...", prayer: "Help me trust Your timing.", encouragement: "Your future is bright." },
            { verse: "Isa 40:31", text: "Renew their strength...", prayer: "Renew my strength, Lord.", encouragement: "God is strengthening you." },
            { verse: "Rom 8:28", text: "All things work for good...", prayer: "Thank You for Your plan.", encouragement: "Setbacks are setups." },
            { verse: "Ps 46:10", text: "Be still...", prayer: "Quiet my thoughts.", encouragement: "Peace is His presence." }
        ];

        const BIBLE_BOOKS = [
            { category: "Foundations", books: [{ name: "Genesis", theme: "Beginnings", app: "Family & Legacy", keys: "Gen 1" }, { name: "Proverbs", theme: "Wisdom", app: "Finance & Habits", keys: "Prov 3" }] },
            { category: "Leadership", books: [{ name: "Joshua", theme: "Conquest", app: "Courage", keys: "Josh 1" }, { name: "Nehemiah", theme: "Rebuilding", app: "Management", keys: "Neh 1" }] },
            { category: "Gospels", books: [{ name: "Matthew", theme: "King", app: "Ethics", keys: "Matt 5" }, { name: "John", theme: "God", app: "Identity", keys: "John 1" }] },
            { category: "Letters", books: [{ name: "Romans", theme: "Gospel", app: "Mindset", keys: "Rom 8" }, { name: "James", theme: "Action", app: "Integrity", keys: "Jas 1" }] }
        ];

        // --- HELPERS ---
        const Card = ({ children, className = "", title, action }) => (
            React.createElement("div", { className: `bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-2xl p-4 md:p-6 flex flex-col ${className}` },
                (title || action) && (
                    React.createElement("div", { className: "flex justify-between items-center mb-4" },
                        title && React.createElement("h3", { className: "text-sm font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wider" }, title),
                        action
                    )
                ),
                children
            )
        );

        const NavItem = ({ icon: Icon, label, active, onClick }) => (
            React.createElement("button", { 
                onClick: onClick,
                className: `w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 group ${active ? 'bg-zinc-900 text-white dark:bg-white dark:text-zinc-900 shadow-lg shadow-zinc-200 dark:shadow-none' : 'text-zinc-500 hover:bg-zinc-100 dark:text-zinc-400 dark:hover:bg-zinc-800'}`
            },
                React.createElement(Icon, { size: 20, className: active ? '' : 'stroke-[2px]' }),
                React.createElement("span", { className: "font-medium" }, label),
                active && React.createElement(ChevronRight, { size: 16, className: "ml-auto opacity-50" })
            )
        );

        const QuickLinkButton = ({ href, icon: Icon, label, colorClass = "text-zinc-600 dark:text-zinc-300" }) => (
            React.createElement("a", { href: href, target: "_blank", rel: "noopener noreferrer", className: "flex flex-col items-center justify-center gap-2 p-3 rounded-xl bg-zinc-50 dark:bg-zinc-950/50 border border-zinc-100 dark:border-zinc-800 hover:border-indigo-500/50 hover:bg-white dark:hover:bg-zinc-900 hover:shadow-md transition-all group text-center h-full" },
                React.createElement("div", { className: `w-8 h-8 rounded-full flex items-center justify-center bg-white dark:bg-zinc-900 shadow-sm group-hover:scale-110 transition-transform ${colorClass}` }, React.createElement(Icon, { size: 16 })),
                React.createElement("span", { className: "text-xs font-medium text-zinc-600 dark:text-zinc-400 group-hover:text-indigo-600 dark:group-hover:text-indigo-400 line-clamp-1" }, label)
            )
        );

        // --- NEW COMPONENT: MOBILE TOP BAR ---
        const MobileTopBar = ({ handleLogout }) => (
            React.createElement("header", { className: "md:hidden fixed top-0 left-0 right-0 bg-white/90 dark:bg-zinc-950/90 backdrop-blur-md border-b border-zinc-200 dark:border-zinc-800 z-50 px-4 h-16 flex items-center justify-between transition-all duration-300" },
                React.createElement("div", { className: "flex items-center gap-3" },
                    React.createElement("div", { className: "w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center text-white shadow-lg shadow-indigo-500/20" }, React.createElement(Brain, { size: 18 })),
                    React.createElement("span", { className: "font-bold text-lg tracking-tight text-zinc-900 dark:text-zinc-100" }, "LifeOS")
                ),
                React.createElement("button", { 
                    onClick: handleLogout, 
                    className: "flex items-center gap-2 px-3 py-1.5 bg-red-50 dark:bg-red-900/10 text-red-600 dark:text-red-400 rounded-lg text-xs font-bold border border-red-100 dark:border-red-900/20 active:scale-95 transition-all" 
                },
                    React.createElement(LogOut, { size: 14 }),
                    "Sign Out"
                )
            )
        );

        // --- UPDATED MOBILE NAV BAR (Tabs Only) ---
        const MobileNavBar = ({ activeTab, setActiveTab, tabConfig }) => {
            const tabs = ['dashboard', 'goals2026', 'tasks', 'worries', 'focus', 'braindump', 'spirituality', 'food', 'fitness', 'tools'];
            
            return React.createElement("div", { className: "md:hidden fixed bottom-0 left-0 right-0 bg-white/90 dark:bg-zinc-950/90 backdrop-blur-lg border-t border-zinc-200 dark:border-zinc-800 z-50 px-2 py-1 pb-safe flex h-[4.5rem] shadow-[0_-5px_20px_rgba(0,0,0,0.1)]" },
                React.createElement("div", { className: "flex-1 flex overflow-x-auto no-scrollbar items-center px-2 gap-1" },
                    tabs.map(t => {
                        const isActive = activeTab === t;
                        const config = tabConfig[t];
                        return React.createElement("button", {
                            key: t,
                            onClick: () => setActiveTab(t),
                            className: `flex flex-col items-center justify-center min-w-[3.5rem] h-full rounded-xl transition-all shrink-0 ${isActive ? 'text-indigo-600' : 'text-zinc-400 dark:text-zinc-500 hover:text-zinc-600 dark:hover:text-zinc-300'}`
                        },
                            React.createElement("div", { className: `p-1.5 rounded-lg mb-0.5 transition-all ${isActive ? 'bg-indigo-50 dark:bg-indigo-500/20' : 'bg-transparent'}` },
                                React.createElement(config.icon, { size: 20, strokeWidth: isActive ? 2.5 : 2 })
                            ),
                            React.createElement("span", { className: "text-[9px] font-medium leading-none" }, config.label.split(' ')[0]) // Shorten label for mobile
                        );
                    })
                )
            );
        };

        // --- AUTH COMPONENT ---
        const AuthModal = ({ onClose, onLogin }) => {
            const [activeTab, setActiveTab] = useState("login"); // 'login' or 'signup'
            const [email, setEmail] = useState("");
            const [password, setPassword] = useState("");
            const [confirmPassword, setConfirmPassword] = useState("");
            const [showPassword, setShowPassword] = useState(false);
            const [error, setError] = useState(null);
            const [loading, setLoading] = useState(false);

            const isLogin = activeTab === "login";

            const handleSubmit = async (e) => {
                e.preventDefault(); setError(null); setLoading(true);
                
                if (!isLogin && password !== confirmPassword) {
                    setError("Passwords do not match."); setLoading(false); return;
                }

                try {
                    // Try real Firebase Auth first
                    if (isLogin) await signInWithEmailAndPassword(auth, email, password);
                    else await createUserWithEmailAndPassword(auth, email, password);
                    onLogin({ email, uid: auth.currentUser.uid, isLocal: false, displayName: email.split('@')[0] });
                    onClose();
                } catch (err) { 
                    console.warn("Auth Error caught, checking fallback...", err.code);
                    let msg = err.message.replace("Firebase: ", "");
                    
                    // FALLBACK TO LOCAL AUTH
                    try {
                        const localUser = isLogin 
                            ? LocalAuth.login(email, password)
                            : LocalAuth.signup(email, password);
                        onLogin(localUser);
                        onClose();
                        return;
                    } catch (localErr) {
                         setError(localErr.message); 
                    }
                } finally { setLoading(false); }
            };

            const handleGoogleLogin = async () => {
                 setLoading(true);
                 setTimeout(() => {
                     // Simulate a Google user
                     const user = { 
                         email: "demo.user@gmail.com", 
                         displayName: "Demo User",
                         uid: "google-local-" + Date.now(), 
                         isLocal: true 
                     };
                     onLogin(user);
                     onClose();
                     setLoading(false);
                 }, 500);
            };

            return React.createElement("div", { className: "fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm animate-in fade-in duration-200" },
                React.createElement("div", { className: "bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-2xl p-8 max-w-sm w-full relative shadow-2xl" },
                    React.createElement("button", { onClick: onClose, className: "absolute top-4 right-4 text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200" }, React.createElement(X, { size: 20 })),
                    
                    // Header with Tabs
                    React.createElement("div", { className: "text-center mb-6" },
                        React.createElement("div", { className: "w-12 h-12 rounded-full bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 flex items-center justify-center mx-auto mb-3" }, React.createElement(LogIn, { size: 24 })),
                        React.createElement("div", { className: "flex justify-center gap-4 border-b border-zinc-100 dark:border-zinc-800 pb-2 mt-4" },
                            React.createElement("button", { onClick: () => { setActiveTab("login"); setError(null); }, className: `pb-2 text-sm font-bold transition-colors border-b-2 ${isLogin ? 'text-indigo-600 border-indigo-600' : 'text-zinc-400 border-transparent hover:text-zinc-600'}` }, "Sign In"),
                            React.createElement("button", { onClick: () => { setActiveTab("signup"); setError(null); }, className: `pb-2 text-sm font-bold transition-colors border-b-2 ${!isLogin ? 'text-indigo-600 border-indigo-600' : 'text-zinc-400 border-transparent hover:text-zinc-600'}` }, "Create Account")
                        )
                    ),

                    React.createElement("div", { className: "space-y-4" },
                        React.createElement("button", { onClick: handleGoogleLogin, disabled: loading, className: "w-full py-3 bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 hover:bg-zinc-50 dark:hover:bg-zinc-700 text-zinc-700 dark:text-zinc-200 font-bold rounded-xl transition-colors flex items-center justify-center gap-2" }, 
                            React.createElement("img", { src: "https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg", className: "w-5 h-5", alt: "G" }), "Sign in with Google"
                        ),
                        React.createElement("div", { className: "relative flex py-2 items-center" }, React.createElement("div", { className: "flex-grow border-t border-zinc-200 dark:border-zinc-800" }), React.createElement("span", { className: "flex-shrink mx-4 text-xs text-zinc-400 uppercase" }, "Or"), React.createElement("div", { className: "flex-grow border-t border-zinc-200 dark:border-zinc-800" })),
                        React.createElement("form", { onSubmit: handleSubmit, className: "space-y-4" },
                            React.createElement("input", { type: "email", required: true, value: email, onChange: (e) => setEmail(e.target.value), placeholder: "Email", className: "w-full p-3 rounded-xl bg-zinc-50 dark:bg-zinc-950 border border-zinc-200 dark:border-zinc-800 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 text-zinc-900 dark:text-zinc-100" }),
                            
                            // Password Field with Toggle
                            React.createElement("div", { className: "relative" },
                                React.createElement("input", { type: showPassword ? "text" : "password", required: true, value: password, onChange: (e) => setPassword(e.target.value), placeholder: "Password", className: "w-full p-3 rounded-xl bg-zinc-50 dark:bg-zinc-950 border border-zinc-200 dark:border-zinc-800 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 text-zinc-900 dark:text-zinc-100 pr-10" }),
                                React.createElement("button", { type: "button", onClick: () => setShowPassword(!showPassword), className: "absolute right-3 top-1/2 -translate-y-1/2 text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200" }, React.createElement(showPassword ? EyeOff : Eye, { size: 18 }))
                            ),

                            !isLogin && React.createElement("input", { type: "password", required: true, value: confirmPassword, onChange: (e) => setConfirmPassword(e.target.value), placeholder: "Confirm Password", className: "w-full p-3 rounded-xl bg-zinc-50 dark:bg-zinc-950 border border-zinc-200 dark:border-zinc-800 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 text-zinc-900 dark:text-zinc-100" }),
                            
                            error && React.createElement("div", { className: "p-3 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 text-sm rounded-lg flex items-center gap-2" }, React.createElement(AlertCircle, { size: 16 }), error),
                            
                            React.createElement("button", { type: "submit", disabled: loading, className: "w-full py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-xl transition-colors disabled:opacity-50" }, loading ? "Processing..." : (isLogin ? "Sign In" : "Create Account"))
                        )
                    )
                )
            );
        };

        // --- LANDING PAGE ---
        const LandingPage = ({ onLoginSuccess, onGuestLogin }) => {
            const [activeTab, setActiveTab] = useState("login"); // 'login' or 'signup'
            const [email, setEmail] = useState("");
            const [password, setPassword] = useState("");
            const [confirmPassword, setConfirmPassword] = useState("");
            const [showPassword, setShowPassword] = useState(false);
            const [error, setError] = useState(null);
            const [loading, setLoading] = useState(false);

            const isLogin = activeTab === "login";

            const handleSubmit = async (e) => {
                e.preventDefault(); setError(null); setLoading(true);
                if (!isLogin && password !== confirmPassword) { setError("Passwords do not match."); setLoading(false); return; }

                try {
                    if (isLogin) await signInWithEmailAndPassword(auth, email, password);
                    else await createUserWithEmailAndPassword(auth, email, password);
                    onLoginSuccess({ email, uid: auth.currentUser.uid, isLocal: false, displayName: email.split('@')[0] });
                } catch (err) { 
                    console.warn("Auth Fallback (Landing):", err.code);
                    try {
                         const localUser = isLogin 
                             ? LocalAuth.login(email, password)
                             : LocalAuth.signup(email, password);
                         onLoginSuccess(localUser);
                         return;
                     } catch (localErr) {
                         setError(localErr.message);
                         setLoading(false);
                         return;
                     }
                } finally { setLoading(false); }
            };

            const handleGoogleLogin = async () => {
                setLoading(true);
                setTimeout(() => {
                    onLoginSuccess({ 
                        email: "demo.user@gmail.com", 
                        displayName: "Demo User",
                        uid: "google-local-" + Date.now(), 
                        isLocal: true 
                    });
                    setLoading(false);
                }, 800);
            };

            const handleGuest = () => {
                 onGuestLogin({ email: "guest@lifeos.app", displayName: "Guest", uid: "guest-user", isLocal: true });
            };

            return React.createElement("div", { className: "min-h-screen flex flex-col md:flex-row bg-zinc-950 text-white font-sans" },
                React.createElement("div", { className: "md:w-1/2 p-12 flex flex-col justify-between landing-gradient relative overflow-hidden" },
                    React.createElement("div", { className: "relative z-10" },
                        React.createElement("div", { className: "flex items-center gap-3 mb-8" },
                            React.createElement("div", { className: "w-10 h-10 bg-indigo-600 rounded-xl flex items-center justify-center" }, React.createElement(Brain, { size: 24, className: "text-white" })),
                            React.createElement("h1", { className: "text-2xl font-bold tracking-tight" }, "LifeOS")
                        ),
                        React.createElement("h2", { className: "text-5xl md:text-6xl font-bold mb-6 leading-tight" }, "Your Second", React.createElement("br"), React.createElement("span", { className: "text-indigo-500" }, "Brain.")),
                        React.createElement("p", { className: "text-zinc-400 text-lg max-w-md leading-relaxed" }, "Organize your entire life. Master your habits. Achieve your 2026 vision. All in one place.")
                    ),
                    React.createElement("div", { className: "relative z-10 mt-12 grid grid-cols-2 gap-6" },
                        React.createElement("div", { className: "flex items-center gap-3 text-zinc-300" }, React.createElement(CheckCircle2, { className: "text-emerald-500" }), "Goal Tracking"),
                        React.createElement("div", { className: "flex items-center gap-3 text-zinc-300" }, React.createElement(CheckCircle2, { className: "text-blue-500" }), "Focus Timer"),
                        React.createElement("div", { className: "flex items-center gap-3 text-zinc-300" }, React.createElement(CheckCircle2, { className: "text-amber-500" }), "Daily Journal"),
                        React.createElement("div", { className: "flex items-center gap-3 text-zinc-300" }, React.createElement(CheckCircle2, { className: "text-indigo-500" }), "Habit Builder")
                    ),
                    React.createElement("div", { className: "absolute top-0 right-0 w-96 h-96 bg-indigo-600/20 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2" }),
                    React.createElement("div", { className: "absolute bottom-0 left-0 w-64 h-64 bg-rose-600/10 rounded-full blur-3xl translate-y-1/2 -translate-x-1/2" })
                ),
                React.createElement("div", { className: "md:w-1/2 bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 flex flex-col justify-center p-8 md:p-16" },
                    React.createElement("div", { className: "max-w-md w-full mx-auto" },
                        React.createElement("div", { className: "mb-8 text-center" },
                            React.createElement("h3", { className: "text-3xl font-bold mb-2" }, isLogin ? "Welcome Back" : "Create Account"),
                            React.createElement("p", { className: "text-zinc-500" }, isLogin ? "Enter your details to access your workspace." : "Start your journey to clarity today.")
                        ),
                        
                        React.createElement("div", { className: "space-y-4" },
                            React.createElement("button", { onClick: handleGoogleLogin, disabled: loading, className: "w-full py-3 mb-6 bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 hover:bg-zinc-50 dark:hover:bg-zinc-700 text-zinc-700 dark:text-zinc-200 font-bold rounded-xl transition-all flex items-center justify-center gap-3 shadow-sm" },
                                React.createElement("img", { src: "https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg", className: "w-5 h-5", alt: "G" }), "Continue with Google"
                            ),
                            React.createElement("div", { className: "relative flex py-2 items-center mb-6" },
                                React.createElement("div", { className: "flex-grow border-t border-zinc-200 dark:border-zinc-800" }),
                                React.createElement("span", { className: "flex-shrink mx-4 text-xs text-zinc-400 uppercase font-bold tracking-wider" }, "Or with Email"),
                                React.createElement("div", { className: "flex-grow border-t border-zinc-200 dark:border-zinc-800" })
                            ),
                            
                            // LANDING TABS
                            React.createElement("div", { className: "flex justify-center gap-6 border-b border-zinc-200 dark:border-zinc-800 pb-1 mb-4" },
                                React.createElement("button", { onClick: () => { setActiveTab("login"); setError(null); }, className: `pb-2 text-sm font-bold transition-colors border-b-2 ${isLogin ? 'text-indigo-600 border-indigo-600' : 'text-zinc-400 border-transparent hover:text-zinc-600'}` }, "Sign In"),
                                React.createElement("button", { onClick: () => { setActiveTab("signup"); setError(null); }, className: `pb-2 text-sm font-bold transition-colors border-b-2 ${!isLogin ? 'text-indigo-600 border-indigo-600' : 'text-zinc-400 border-transparent hover:text-zinc-600'}` }, "Create Account")
                            ),

                            React.createElement("form", { onSubmit: handleSubmit, className: "space-y-4" },
                                React.createElement("div", null, React.createElement("label", { className: "block text-xs font-bold text-zinc-500 uppercase mb-1 ml-1" }, "Email Address"), React.createElement("input", { type: "email", required: true, value: email, onChange: (e) => setEmail(e.target.value), placeholder: "name@example.com", className: "w-full p-3 rounded-xl bg-zinc-50 dark:bg-zinc-950 border border-zinc-200 dark:border-zinc-800 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 transition-all text-zinc-900 dark:text-zinc-100" })),
                                
                                // Password Field with Toggle
                                React.createElement("div", null,
                                    React.createElement("label", { className: "block text-xs font-bold text-zinc-500 uppercase mb-1 ml-1" }, "Password"),
                                    React.createElement("div", { className: "relative" },
                                        React.createElement("input", { type: showPassword ? "text" : "password", required: true, value: password, onChange: (e) => setPassword(e.target.value), placeholder: "••••••••", className: "w-full p-3 rounded-xl bg-zinc-50 dark:bg-zinc-950 border border-zinc-200 dark:border-zinc-800 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 transition-all text-zinc-900 dark:text-zinc-100 pr-10" }),
                                        React.createElement("button", { type: "button", onClick: () => setShowPassword(!showPassword), className: "absolute right-3 top-1/2 -translate-y-1/2 text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200" }, React.createElement(showPassword ? EyeOff : Eye, { size: 18 }))
                                    )
                                ),

                                !isLogin && React.createElement("div", null, React.createElement("label", { className: "block text-xs font-bold text-zinc-500 uppercase mb-1 ml-1" }, "Confirm Password"), React.createElement("input", { type: "password", required: true, value: confirmPassword, onChange: (e) => setConfirmPassword(e.target.value), placeholder: "••••••••", className: "w-full p-3 rounded-xl bg-zinc-50 dark:bg-zinc-950 border border-zinc-200 dark:border-zinc-800 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 transition-all text-zinc-900 dark:text-zinc-100" })),
                                
                                error && React.createElement("div", { className: "p-3 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 text-sm rounded-lg flex items-center gap-2" }, React.createElement(AlertCircle, { size: 16 }), error),
                                
                                React.createElement("button", { type: "submit", disabled: loading, className: "w-full py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-xl transition-all shadow-lg hover:shadow-indigo-500/20 disabled:opacity-50 disabled:cursor-not-allowed mt-2" }, loading ? "Processing..." : (isLogin ? "Sign In" : "Create Account"))
                            ),
                            React.createElement("div", { className: "mt-6 text-center" },
                                React.createElement("button", { onClick: handleGuest, disabled: loading, className: "text-xs text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-300 transition-colors uppercase tracking-wider font-bold" }, "Continue as Guest")
                            )
                        )
                    )
                )
            );
        };

        // --- APP COMPONENT ---

        const App = () => {
            // UPDATED: Reordered tabs and added configuration for icons/labels
            const tabConfig = {
                dashboard: { label: "Dashboard", icon: Layout },
                goals2026: { label: "2026 Plan", icon: Flag },
                tasks: { label: "Daily Tasks", icon: ListTodo },
                worries: { label: "Worries", icon: ShieldAlert },
                focus: { label: "Focus Mode", icon: Timer },
                braindump: { label: "Brain Dump", icon: FileText },
                spirituality: { label: "Spirituality", icon: Flower2 },
                food: { label: "Food Plan", icon: Utensils },
                fitness: { label: "Fitness", icon: Dumbbell },
                tools: { label: "Tools", icon: Wrench }
            };

            const VALID_TABS = ['dashboard', 'goals2026', 'tasks', 'worries', 'focus', 'braindump', 'spirituality', 'food', 'fitness', 'tools'];
            
            const [activeTab, setActiveTab] = useState(() => localStorage.getItem('lifeos_active_tab') || 'dashboard');
            const [darkMode, setDarkMode] = useState(() => JSON.parse(localStorage.getItem('lifeos_dark_mode') || 'true'));
            
            // Session Persistence
            const [user, setUser] = useState(() => {
                try {
                    const stored = localStorage.getItem('lifeos_user_session');
                    return stored ? JSON.parse(stored) : null;
                } catch(e) { return null; }
            });
            
            const [isDataLoaded, setIsDataLoaded] = useState(false);
            const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
            const [showShareModal, setShowShareModal] = useState(false);
            const [showAuthModal, setShowAuthModal] = useState(false);
            const [authError, setAuthError] = useState(null);

            const [dumps, setDumps] = useState([]);
            const [spiritualNotes, setSpiritualNotes] = useState([]);
            const [meals, setMeals] = useState([]);
            const [worries, setWorries] = useState([]);
            const [tasks, setTasks] = useState([]);
            const [goalsProgress, setGoalsProgress] = useState({});
            const [goalsData, setGoalsData] = useState(DEFAULT_GOALS_DATA); 
            const [dashboardData, setDashboardData] = useState({ focus: "", habits: [] });
            const [tools, setTools] = useState(DEFAULT_TOOLS); // NEW STATE FOR TOOLS
            
            // GLOBAL FOCUS STATE
            const [activeSound, setActiveSound] = useState(null);
            const [isPlayingSound, setIsPlayingSound] = useState(false);
            const audioRef = useRef(new Audio());
            const [focusState, setFocusState] = useState({
                timeLeft: 25 * 60,
                isActive: false,
                initialTime: 25 * 60
            });

            // Focus Timer Logic
            useEffect(() => {
                let interval = null;
                if (focusState.isActive && focusState.timeLeft > 0) { interval = setInterval(() => { setFocusState(prev => ({ ...prev, timeLeft: prev.timeLeft - 1 })); }, 1000); } else if (focusState.timeLeft === 0) { setFocusState(prev => ({ ...prev, isActive: false })); }
                return () => clearInterval(interval);
            }, [focusState.isActive, focusState.timeLeft]);
            const handleTimerToggle = () => setFocusState(prev => ({ ...prev, isActive: !prev.isActive }));
            const handleTimerReset = (newTime) => { const time = newTime || focusState.initialTime; setFocusState({ timeLeft: time, isActive: false, initialTime: time }); };

            // Auth Listener
            useEffect(() => {
                if (isFirebaseConfigured) {
                    const unsubscribe = onAuthStateChanged(auth, (u) => {
                        if (u && (!user || !user.isLocal)) {
                             const newUser = { email: u.email || "Guest", uid: u.uid, isLocal: false, displayName: u.displayName || u.email.split('@')[0] };
                             setUser(newUser);
                             localStorage.setItem('lifeos_user_session', JSON.stringify(newUser));
                        }
                    });
                    return () => unsubscribe();
                }
            }, []);

            // Login Success
            const handleLoginSuccess = (userData) => {
                setUser(userData);
                localStorage.setItem('lifeos_user_session', JSON.stringify(userData));
                setIsDataLoaded(false); 
                setShowAuthModal(false);
            };

            const handleLogout = () => {
                if (isFirebaseConfigured && auth.currentUser) signOut(auth);
                setUser(null);
                localStorage.removeItem('lifeos_user_session');
                setIsDataLoaded(false);
                setDumps([]); setSpiritualNotes([]); setMeals([]); setTasks([]); setWorries([]); setGoalsData(DEFAULT_GOALS_DATA); setDashboardData({ focus: "", habits: [] }); setTools(DEFAULT_TOOLS);
            };

            // Data Sync
            useEffect(() => {
                if (!user) return;
                const userId = user.uid;
                const prefix = `lifeos_data_${userId}_`;
                try {
                    setDumps(JSON.parse(localStorage.getItem(`${prefix}dumps`) || '[]'));
                    setSpiritualNotes(JSON.parse(localStorage.getItem(`${prefix}spiritual_notes`) || '[]'));
                    setMeals(JSON.parse(localStorage.getItem(`${prefix}meals`) || '[]'));
                    setTasks(JSON.parse(localStorage.getItem(`${prefix}tasks`) || '[]'));
                    setWorries(JSON.parse(localStorage.getItem(`${prefix}worries`) || '[]'));
                    const loadedGoals = localStorage.getItem(`${prefix}goals_data_2026`);
                    setGoalsData(loadedGoals ? JSON.parse(loadedGoals) : DEFAULT_GOALS_DATA);
                    const loadedTools = localStorage.getItem(`${prefix}tools`); // Load Tools
                    setTools(loadedTools ? JSON.parse(loadedTools) : DEFAULT_TOOLS);
                    setDashboardData(JSON.parse(localStorage.getItem(`${prefix}dashboard`) || '{"focus":"", "habits":[]}'));
                    setIsDataLoaded(true);
                } catch(e) { console.error("Local Load Error", e); }
            }, [user]);

            // Save to LocalStorage
            useEffect(() => {
                if (user && isDataLoaded) {
                    const prefix = `lifeos_data_${user.uid}_`;
                    localStorage.setItem(`${prefix}dumps`, JSON.stringify(dumps));
                    localStorage.setItem(`${prefix}spiritual_notes`, JSON.stringify(spiritualNotes));
                    localStorage.setItem(`${prefix}meals`, JSON.stringify(meals));
                    localStorage.setItem(`${prefix}tasks`, JSON.stringify(tasks));
                    localStorage.setItem(`${prefix}worries`, JSON.stringify(worries));
                    localStorage.setItem(`${prefix}goals_data_2026`, JSON.stringify(goalsData));
                    localStorage.setItem(`${prefix}tools`, JSON.stringify(tools)); // Save Tools
                    localStorage.setItem(`${prefix}dashboard`, JSON.stringify(dashboardData));
                }
            }, [dumps, spiritualNotes, meals, tasks, worries, goalsData, dashboardData, tools, user, isDataLoaded]);

            // Handlers
            const handleAddDump = (text) => setDumps(prev => [{ id: Date.now().toString(), text, createdAt: new Date() }, ...prev]);
            const handleDeleteDump = (id) => setDumps(prev => prev.filter(d => d.id !== id));
            const handleAddSpiritualNote = (text) => setSpiritualNotes(prev => [{ id: Date.now().toString(), text, createdAt: new Date() }, ...prev]);
            const handleDeleteSpiritualNote = (id) => setSpiritualNotes(prev => prev.filter(n => n.id !== id));
            const handleAddWorry = (text) => setWorries(prev => [{ id: Date.now().toString(), text, createdAt: new Date() }, ...prev]);
            const handleDeleteWorry = (id) => setWorries(prev => prev.filter(w => w.id !== id));
            const handleAddTask = (task) => setTasks(prev => [{ id: Date.now().toString(), ...task, createdAt: new Date() }, ...prev]);
            const handleUpdateTask = (id, data) => setTasks(prev => prev.map(t => t.id === id ? { ...t, ...data } : t));
            const handleDeleteTask = (id) => setTasks(prev => prev.filter(t => t.id !== id));
            const handleUpdateDashboard = (data) => setDashboardData(data);
            const handleUpdateGoals = (newData) => setGoalsData(newData);
            const handleAddTool = (tool) => setTools(prev => [...prev, { id: Date.now().toString(), ...tool }]); // Add Tool Handler

            const handleUpdateMeal = (day, type, text) => {
                const existingMeal = meals.find(m => m.day === day && m.type === type);
                const docId = `${day}_${type}`;
                if (existingMeal) { 
                    setMeals(prev => prev.map(m => m.day === day && m.type === type ? { ...m, text, id: docId } : m));
                } else { 
                    const newMeal = { id: docId, day, type, text };
                    setMeals(prev => [...prev, newMeal]);
                }
            };

            const toggleSound = (sound) => {
                if (activeSound === sound.id && isPlayingSound) { audioRef.current.pause(); setIsPlayingSound(false); }
                else { audioRef.current.src = sound.url; audioRef.current.loop = true; audioRef.current.play(); setIsPlayingSound(true); setActiveSound(sound.id); }
            };

            useEffect(() => { if (darkMode) document.documentElement.classList.add('dark'); else document.documentElement.classList.remove('dark'); }, [darkMode]);
            useEffect(() => localStorage.setItem('lifeos_active_tab', activeTab), [activeTab]);

            if (!user) return React.createElement(LandingPage, { 
                onLoginSuccess: handleLoginSuccess, 
                onGuestLogin: handleLoginSuccess 
            });

            return React.createElement("div", { className: "min-h-screen bg-zinc-50 dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100 font-sans" },
                React.createElement("aside", { className: "fixed left-0 top-0 h-full w-64 border-r border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-950 p-6 hidden md:flex flex-col z-20" },
                    React.createElement("h1", { className: "text-2xl font-bold mb-8" }, "LifeOS"),
                    React.createElement("nav", { className: "space-y-2 flex-1" },
                        VALID_TABS.map(t => React.createElement(NavItem, { 
                            key: t, 
                            icon: tabConfig[t].icon, 
                            label: tabConfig[t].label, 
                            active: activeTab === t, 
                            onClick: () => setActiveTab(t) 
                        }))
                    ),
                    React.createElement("div", { className: "pt-6 border-t border-zinc-200 dark:border-zinc-800 space-y-2" },
                        // PROFILE CARD
                        user && React.createElement("div", { className: "flex items-center gap-3 px-3 py-2 mb-2 rounded-xl bg-zinc-100 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800" },
                            React.createElement("div", { className: "w-8 h-8 rounded-full bg-indigo-100 dark:bg-indigo-900/50 text-indigo-600 dark:text-indigo-400 flex items-center justify-center font-bold text-xs shrink-0" }, 
                                React.createElement(User, { size: 16 })
                            ),
                            React.createElement("div", { className: "flex-1 overflow-hidden" },
                                React.createElement("p", { className: "text-[10px] font-medium text-zinc-500 dark:text-zinc-400 uppercase tracking-wider" }, "Signed in as"),
                                React.createElement("p", { className: "text-xs font-bold text-zinc-800 dark:text-zinc-200 truncate" }, user.displayName || user.email)
                            )
                        ),
                        React.createElement("button", { onClick: () => setDarkMode(!darkMode), className: "w-full flex items-center gap-3 px-4 py-3 rounded-xl text-zinc-500 hover:bg-zinc-100 dark:text-zinc-400 dark:hover:bg-zinc-800 transition-colors" },
                            React.createElement(darkMode ? Sun : Moon, { size: 20 }),
                            React.createElement("span", { className: "font-medium" }, darkMode ? "Light Mode" : "Dark Mode")
                        ),
                        React.createElement("button", { onClick: handleLogout, className: "w-full flex items-center gap-3 px-4 py-3 rounded-xl text-red-500 hover:bg-red-50 dark:hover:bg-red-900/10 transition-colors" },
                            React.createElement(LogOut, { size: 20 }),
                            React.createElement("span", { className: "font-medium" }, "Sign Out")
                        )
                    )
                ),
                
                // NEW: MOBILE TOP BAR
                React.createElement(MobileTopBar, { handleLogout }),
                
                // NEW: MOBILE BOTTOM NAVIGATION BAR
                React.createElement(MobileNavBar, { activeTab, setActiveTab, tabConfig }),

                React.createElement("main", { className: "md:ml-64 p-4 md:p-12 pb-24 pt-20 md:pt-12 max-w-7xl mx-auto" }, // Added pt-20 for mobile header space
                    showAuthModal && React.createElement(AuthModal, { onClose: () => setShowAuthModal(false), onLogin: handleLoginSuccess }),
                    activeTab === 'dashboard' && React.createElement(DashboardView, { 
                        onAddDump: handleAddDump, 
                        dashboardData, 
                        onUpdateDashboard: handleUpdateDashboard, 
                        onNavigate: setActiveTab,
                        timerState: focusState,
                        toggleTimer: handleTimerToggle,
                        resetTimer: handleTimerReset,
                        worries, // PASS WORRIES
                        meals,   // PASS MEALS
                        tasks,   // PASS TASKS
                        goalsData // PASS GOALS
                    }),
                    activeTab === 'goals2026' && React.createElement(Goals2026View, { goalsData, onUpdateGoals: handleUpdateGoals }),
                    activeTab === 'tasks' && React.createElement(TasksView, { tasks, onAddTask: handleAddTask, onUpdateTask: handleUpdateTask, onDeleteTask: handleDeleteTask }),
                    activeTab === 'worries' && React.createElement(WorriesView, { worries, onAddWorry: handleAddWorry, onDeleteWorry: handleDeleteWorry }),
                    activeTab === 'focus' && React.createElement(FocusView, { 
                        activeSound, 
                        isPlayingSound, 
                        toggleSound, 
                        focusState,
                        toggleTimer: handleTimerToggle, 
                        resetTimer: handleTimerReset 
                    }),
                    activeTab === 'braindump' && React.createElement(BrainDumpView, { dumps, onAddDump: handleAddDump, onDeleteDump: handleDeleteDump }),
                    activeTab === 'spirituality' && React.createElement(SpiritualityView, { notes: spiritualNotes, onAddNote: handleAddSpiritualNote, onDeleteNote: handleDeleteSpiritualNote }),
                    activeTab === 'fitness' && React.createElement(FitnessView),
                    activeTab === 'food' && React.createElement(FoodView, { meals, onUpdateMeal: handleUpdateMeal }),
                    activeTab === 'tools' && React.createElement(ToolsView, { tools, onAddTool: handleAddTool })
                )
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
